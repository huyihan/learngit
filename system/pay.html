<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
    	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>支付列表</title>
		<!--<link rel="stylesheet" href="css/jquery.mobile-1.4.5.css" />-->
		<link rel="stylesheet" href="css/comm.css" />
	</head>
	<style>
		main{
			background:url(img/BG-2.png) no-repeat center;
			background-size:cover;
			color:#fff;
		}
		#container{
			padding:.06rem .06rem .45rem;
			display:flex;
			flex-flow:row;
		}
		#container ._left{
			flex:4;
			border:solid .01rem #fff;
			border-radius:.04rem;
		}
		._left{
			padding:.14rem 0;
			display:flex;
			flex-flow:column;
		}
		._left .card-list{
			flex:9;
		}
		._left .card-list li{
			width:50%;
			float:left;
			padding:.29rem .15rem;
			
		}
		._left .card-list li img{
			width:100%;
			height:auto;
		}
		._left .chooseWrap{
			flex:2;
			padding:0 .19rem;
		}
		._left .chooseWrap button{
			width:50%;
			height:.4rem;
			border:solid .01rem #f28f64;
			font-size:.17rem;
			color:#f28f64;
			float:left;
			background:transparent;
			border-radius:0;
		}
		._left .chooseWrap button.active{
			background:#f28f64;
			color:#fff;
		}
		
		#container ._center{
			flex:5;
			border:solid .01rem #f7de14;
			border-radius:.04rem;
			margin:0 .08rem;
			padding:.45rem .2rem 0;
		}
		._center .cal_title{
			width:100%;
			height:.42rem;
			border:solid .01rem #fff;
			border-radius:.05rem;
			margin-bottom:.21rem;
		}
		._center .cal_title input{
			width:100%;
			height:.42rem;
			background: transparent;
			border:none;
			text-align: right;
			padding-right:.1rem;
			font-size:.2rem;
			color:#fff;
		}
		._center .cal_con ol{
			overflow: hidden;
			height:100%;
		}
		
		.cal_con ul{
			overflow: hidden;
			width:100%;
			height:100%;
			padding-left:.39rem;
			margin-top:.17rem;
		}
		.cal_con ul li{
			width:.63rem;
			height:.45rem;
			line-height:.45rem;
			text-align: center;
			background:#1b120f;
			float:left;
			margin-right:.18rem;
			margin-bottom:.15rem;
			background: url(img/icon--cal-s.png) no-repeat center;
		}
		.cal_con ul li.clearScreen{
			width:1.44rem;
			background: url(img/icon--cal-m.png) no-repeat center;
		}
		
		._center .cal_con  ol li{
			width:.97rem;
			height:.42rem;
			background: #c1bfbe;
			color:#2f2843;
			float:left;
			margin:0 .08rem .11rem 0;
			line-height:.42rem;
			text-align:center;
			border-radius:.04rem;
		}
		._center .cal_con  ol li.double{
			width:2.02rem;
			
		}
		._center .submitBtn{
			width:90%;
			display:block;
			height:.42rem;
			background:#f28f64;
			font-size:.21rem;
			color:#fff;
			line-height:.42rem;
			text-align:center;
			margin-top:.49rem;
			border: none;
			outline: none;
		}
		#container ._right{
			flex:6;
			border:solid .01rem #fff;
			border-radius:.04rem;
			display:flex;
			flex-flow:column;
		}
		._right .title{
			width:100%;
			height:.69rem;
			line-height:.69rem;
			text-align: center;
			font-size:.21rem;
			background:rgba(183,166,26,.6);
		}
		._right ul{
			flex:1;
		}
		._right ul li{
			height:.42rem;
			border-bottom:solid .01rem #fff;
			font-size:.21rem;
			line-height:.42rem;
			display:flex;
			flex-flow:row;
			padding:0 .2rem;
		}
		._right ul li span{
			width:1rem;
		}
		._right ul li div{
			flex:1;
			display:block;
		}
		
		._right ul li input{
			flex:1;
			height:.4rem;
			line-height:.4rem;
			text-align:right;
			color:#fff;
			font-size:.20rem;
		}
		
	</style>
	<body>
		<main data-role = "content">
			<header class = "headerWrap"></header>
			<div id = "container">
				<div class = "_left">
					<ul class = "card-list">
						<li data-paytype = "6">
							<img src = "img/183836527368980243.png" />
							<p>现金支付</p>
						</li>
						
					</ul>
					<div class = "chooseWrap">
						<button class = "active">单选择</button>
						<button>多选择</button>
					</div>
				</div>
				<div class = "_center">
					<div class = "calculate"></div>
					<button class= "submitBtn" id = "submitBtn">确定</button>
				</div>
				<div class = "_right">
					<div class = "title">支付详情</div>
					<ul>
						<li>
							<span>产品折扣</span>
							<input type = "text"/>
						</li>
						<li style = "margin-bottom:.6rem;">
							<span>特别折扣</span>
							<input type = "text"/>
						</li>
						<li>
							<span>总额</span>
							<input type = "text"/>
						</li>
						<li style = "margin-bottom:2rem;">
							<span>服务费</span>
							<input type = "text"/>
						</li>
						<li class = "dealwith">
							<span>应付金额</span>
							<input type = "text"/>
						</li>
						<li class = "payTotal" id= "payTotal">
							<span>实收金额</span>
							<input type = "text"/>
						</li>
						<li id = "lcount" style = "border-bottom:none;">
							<span>找零</span>
							<input type = "text"/>
						</li>
					</ul>
				</div>
			</div>
		</main>
		<div class = "menuWrap"></div>
	</body>
</html>
<script type="text/javascript" src="js/jquery-1.9.1.min.js" ></script>
<!--<script type="text/javascript" src="js/jquery.mobile-1.4.5.js" ></script>-->
<script type="text/javascript" src="js/template.js" ></script>
<script type="text/javascript" src="js/calculate.js" ></script>
<script type="text/javascript" src="js/comm.js" ></script>
<script>
	template();
	var orderNum=comm.getQueryString('orderid'),//订单号
	tableid=comm.getQueryString('tableid'),//当前餐桌id;
	dealwith=0,//应付金额
	orderInfo;//订单相关信息
	/*db.transaction(function(context){
		context.executeSql('SELECT * FROM takeorderTable WHERE orderNum=?',[orderNum],function(tx,result){
			console.log(result);
			if(result.rows.length==0){return;}
			$('#prefer').attr('placeholder',result.rows.item(0).dealwith);
			$('.dealwith input').val(result.rows.item(0).dealwith);
			$('#just').data('value',result.rows.item(0).dealwith);
		})
	})*/
	
	var calculate1 = new calculate();
	calculate1.init({
		trigger:'.calculate'
	})
	var preferStr = $('#prefer').val();
	 
	$('._center').on('click',' ol li',function(){
		$('#prefer').val($(this).data('value'));
		preferStr = $('#prefer').val();
	})
	
	$('._center').on('click','._number',function(){
	 	preferStr+=$(this).html();
	 	$('#prefer').val(preferStr);
	 	$('#payTotal input').val(preferStr);
	 	$('#lcount input').val(comm.sub(preferStr,dealwith))
	})
	$('.clearScreen').click(function(){
		$('#prefer').val(' ');
		preferStr = '';
	})
	$('.tab').on('click',function(){
		console.log(preferStr);
		preferStr = preferStr.substring(0,String(preferStr).length-1);
		$('#prefer').val(preferStr);
	})
	
	/*获取购物车订单信息*/
	comm.getAjax('/cart/read',{"table_id":tableid},function(info){
		console.log(info);
	 	orderInfo = info;
	 	for(var i = 0; i < info.data.cartsgoods.length; i++){
	 		dealwith = comm.add(dealwith,info.data.cartsgoods[i].total);
	 		
	 	}
	 	console.log(dealwith)
	 	$('.dealwith input').val(dealwith);
	 	$('#prefer').attr('placeholder',dealwith);
		$('#just').data('value',dealwith);
	})
	 /*支付完成  生成订单*/
	$('#submitBtn').on('click',function(){
		console.log(orderInfo)
		var payData = {
			"create_date":comm.getTime(new Date().valueOf()).split(' ')[0],                       //创建日期
			"weid": localStorage.getItem('weid'),                       //品牌标识
			"storeid": localStorage.getItem('storeid'),                      //门店标识
			"tables": tableid,                        //餐桌id
			"counts":orderInfo.data.person,                        //就餐人数
			"username":orderInfo.data.name,                     //会员姓名
			"fan_id":"",                         //会员id（零时用户为空）
			"pos_id":"1",                              //终端号
			"meal_time":(new Date(orderInfo.data.create_time).valueOf()),                         //就餐时间
			"finish_time":comm.getTime(new Date().valueOf()),                           //完成时间（时分秒）
			"ordersn":orderInfo.data.order_id,                                  //订单号
			"tablezonesid":"2",                                                    //餐桌区域id
			"remark":orderInfo.data.remark,                                                    //备注
			"status":"2",                                //订单状态(详细说明见文档备注)
			"paytype":"6",                             //支付方式(详细说明见文档备注)
			"transid":"",                        //支付成功返回的内部订单号
			"totalnum":orderInfo.data.cartsgoods.length,                                                  //商品总数
			"totalprice":"30",                                               //折扣前总金额（退款时为负数）
			"discount":"5",                                          //总折扣金额（退款时为负数）
			"price":"35",                                          //备注
			"goods":orderInfo.data.cartsgoods
		}
		payData = JSON.stringify(payData);
		console.log(payData)
		comm.getAjax('/order/save',payData,function(info){
			console.log(info)
		})
	})
</script>